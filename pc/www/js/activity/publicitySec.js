"use strict";new Vue({el:"#APP",delimiters:["${","}"],data:function data(){return{iszhuce:false,open1:0,iszhuce2:false,open2:0,isrule:false,open3:0,showRecommend:false,login:{mobilePhone:"",imgCode:"",msg:"",pwd:"",checkbox:true,recommPhone:""},loginT:{mobilePhone:"",imgCode:"",msg:"",pwd:"",checkbox:true},success:false,successT:false,phoneErr:"",imgCodeErr:"",msgErr:"",passErr:"",checkErr:"",phoneErrT:"",imgCodeErrT:"",msgErrT:"",passErrT:"",checkErrT:"",imgCodeUrl:Verify.imgCodeUrl(),sortName:"获取验证码",sortClass:false,btnClassT:false,errorT:false,errorMsgT:"",imgCodeUrlT:Verify.imgCodeUrl(),sortNameT:"获取验证码",sortClassT:false,btnClass:false,error:false,errorMsg:"",toFrom:"",http:window.location.origin}},watch:{mobile:function mobile(val){this.login.mobilePhone=T.justNumber(val);this.loginT.mobilePhone=T.justNumber(val)}},mounted:function mounted(){this.toFrom=T.getQueryString("toFrom")},methods:{showRule:function showRule(){var self=this;layui.use("layer",function(){layui.use("layer",function(){self.open3=layer.open({type:1,title:false,closeBtn:1,shadeClose:true,end:function end(){self.isrule=false},content:$("#rule")})})})},showreg2:function showreg2(){var self=this;self.iszhuce2=false;layer.close(self.open2);self.showreg()},showreg:function showreg(){var self=this;self.iszhuce=true;layui.use("layer",function(){self.open1=layer.open({type:1,title:false,closeBtn:1,shadeClose:true,end:function end(){self.iszhuce=false;layer.close(self.open1);layui.use("layer",function(){layui.use("layer",function(){self.open2=layer.open({type:1,title:false,closeBtn:1,shadeClose:true,end:function end(){self.iszhuce2=false;layer.close(self.open2)},content:$("#zhucetan2")})})})},content:$("#zhucetan")})})},closetan:function closetan(){var self=this;layui.use("layer",function(){layer.close(self.open2)})},recommend:function recommend(){var self=this;self.showRecommend=!self.showRecommend},clearEvent:function clearEvent(){this.phoneErr="";this.imgCodeErr="";this.msgErr="";this.passErr="";this.checkErr=""},showError:function showError(val){this.error=true;this.errorMsg=val},check:function check(){var self=this;self.login.checkbox=!self.login.checkbox},getImgCodeUrl:function getImgCodeUrl(){var self=this;self.imgCodeUrl=Verify.imgCodeUrl()},getSortMsg:function getSortMsg(event){var self=this;event.stopPropagation();if(self.sortClass)return;this.verMobile(function(){self.verCode(function(){self.isReg(function(){self.sortClass=true;Verify.sendMsg(self.login.mobilePhone,self.login.imgCode,function(status,val){if(status){if(val.status===-1){self.sortName=val.time+"s后重发";self.sortClass=true}else{self.sortName="重新发送";self.sortClass=false}}else{self.msgErr=val;self.sortClass=false}})})})})},isReg:function isReg(callback){var self=this;Verify.varMobile(this.login.mobilePhone).then(function(obj){if(obj.status){callback()}else{self.phoneErr=obj.msg}})},verMobile:function verMobile(callback){var val=Verify.mobile(this.login.mobilePhone);if(val===true){callback()}else{this.phoneErr=val}},verPwd:function verPwd(callback){var val=Verify.pwd(this.login.pwd);if(val===true){callback()}else{this.passErr=val}},verCode:function verCode(callback){var val=Verify.imgCode(this.login.imgCode);if(val===true){callback()}else{this.imgCodeErr=val}},verSort:function verSort(callback){if(this.login.msg==""){this.msgErr="请输入短信验证码"}else if(this.login.msg.length<4){this.msgErr="请输入正确的短信验证码"}callback()},verification:function verification(callback){var self=this;self.verMobile(function(){self.verCode(function(){self.verSort(function(){self.verPwd(function(){if(self.login.checkbox){self.isReg(callback)}else{self.checkErr="请同意注册协义后，再注册。"}})})})})},submit:function submit(){var self=this;this.verification(function(){Verify.register({mobile:self.login.mobilePhone,pwd:self.login.pwd,imgCode:self.login.imgCode,msg:self.login.msg,check:self.login.checkbox,recommPhone:self.login.recommPhone,toFrom:self.toFrom}).then(function(obj){if(obj.status){self.success=true;Verify.toLogin({mobile:self.login.mobilePhone,pwd:self.login.pwd}).then(function(obj){if(obj.status){T.getUserInfo();setTimeout(function(){window.location.href=self.http+"/main/createEscrowAccount"},1e3)}})}else{self.checkErr=obj.msg}})})},clearEventT:function clearEventT(){this.phoneErrT="";this.imgCodeErrT="";this.msgErrT="";this.passErrT=""},getImgCodeUrlT:function getImgCodeUrlT(){var self=this;self.imgCodeUrlT=Verify.imgCodeUrl()},getSortMsgT:function getSortMsgT(event){var self=this;event.stopPropagation();if(self.sortClassT)return;this.verMobileT(function(){self.verCodeT(function(){self.isRegT(function(){self.sortClassT=true;Verify.sendMsg(self.loginT.mobilePhone,self.loginT.imgCode,function(status,val){if(status){if(val.status===-1){self.sortNameT=val.time+"s后重发";self.sortClassT=true}else{self.sortNameT="重新发送";self.sortClassT=false}}else{self.msgErrT=val;self.sortClassT=false}})})})})},isRegT:function isRegT(callback){var self=this;Verify.varMobile(this.loginT.mobilePhone).then(function(obj){if(obj.status){callback()}else{self.phoneErrT=obj.msg}})},verMobileT:function verMobileT(callback){var val=Verify.mobile(this.loginT.mobilePhone);if(val===true){callback()}else{this.phoneErrT=val}},verPwdT:function verPwdT(callback){var val=Verify.pwd(this.loginT.pwd);if(val===true){callback()}else{this.passErrT=val}},verCodeT:function verCodeT(callback){var val=Verify.imgCode(this.loginT.imgCode);if(val===true){callback()}else{this.imgCodeErrT=val}},verSortT:function verSortT(callback){if(this.loginT.msg==""){this.msgErrT="请输入短信验证码"}else if(this.loginT.msg.length<4){this.msgErrT="请输入正确的短信验证码"}callback()},verificationT:function verificationT(callback){var self=this;self.verMobileT(function(){self.verCodeT(function(){self.verSortT(function(){self.verPwdT(function(){if(self.loginT.checkbox){self.isRegT(callback)}else{self.checkErrT="请同意注册协义后，再注册。"}})})})})},submitT:function submitT(){var self=this;this.verificationT(function(){Verify.register({mobile:self.loginT.mobilePhone,pwd:self.loginT.pwd,imgCode:self.loginT.imgCode,msg:self.loginT.msg,check:self.loginT.checkbox,toFrom:self.toFrom}).then(function(obj){if(obj.status){self.successT=true;Verify.toLogin({mobile:self.loginT.mobilePhone,pwd:self.loginT.pwd}).then(function(obj){if(obj.status){T.getUserInfo();setTimeout(function(){window.location.href=self.http+"/main/createEscrowAccount"},1e3)}})}else{self.checkErrT=obj.msg}})})}}});